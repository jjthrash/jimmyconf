#!/usr/bin/env ruby

class Namer
  METASYNTACTIC_VARIABLES = %w(Bob Fred Sue George Henry Horatio Sally Sarah Rosie Chip Daisy)
  ADDR_REGEX = /0x[0-9a-f]{7,8}/

  def build_replacement_map(text)
    text.
      gsub(/NSLayoutConstraint:#{ADDR_REGEX}/, '').
      scan(ADDR_REGEX).
      inject([{}, METASYNTACTIC_VARIABLES]) {|(h, msv), match|
        if h[match]
          [h, msv]
        else
          h[match] = msv[-1]
          [h, msv[0..-2]]
        end
      }[0]
  end

  def label_constraint_list(text)
    map = build_replacement_map(text)
    map.inject(text) {|t, (k,v)|
      t.gsub(k, v)
    }
  end
end

if __FILE__ == $0
  STDOUT.puts Namer.new.label_constraint_list(STDIN.read)
end
