#!/usr/bin/env ruby

class Namer
  METASYNTACTIC_VARIABLES = %w(Bob Fred Sue George Henry Horatio Sally Sarah Rosie Chip Daisy)
  ADDR_REGEX = /0x[0-9a-f]{7,8}/

  def initialize
    @metasyntactic_variables = METASYNTACTIC_VARIABLES
  end

  def next_metasyntactic_variable
    @metasyntactic_variables.pop
  end

  def build_replacement_map(text)
    text.
      gsub(/NSLayoutConstraint:#{ADDR_REGEX}/, '').
      scan(ADDR_REGEX).
      inject({}) {|h, match|
        h[match] ||= next_metasyntactic_variable
        h
      }
  end

  def label_constraint_list(text)
    map = build_replacement_map(text)
    map.inject(text) {|t, (k,v)|
      t.gsub(k, v)
    }
  end
end

if __FILE__ == $0
  STDOUT.puts Namer.new.label_constraint_list(STDIN.read)
end
